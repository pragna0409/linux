<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Cipher Universe</title>
    <link rel="stylesheet" href="styles.css">
    <script src="registration-handler.js"></script>
    <style>
        body {
            overflow-y: auto;
            overflow-x: hidden;
            height: auto;
        }

        .dashboard-container {
            min-height: 100vh;
            background: linear-gradient(135deg, rgba(20, 20, 20, 0.98) 0%, rgba(40, 40, 40, 0.98) 100%);
            padding: 40px 20px;
            overflow-y: visible;
            overflow-x: hidden;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .dashboard-title {
            font-family: 'Intro Rust', 'Arial Black', 'Arial', sans-serif;
            font-size: 3rem;
            font-weight: bold;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 20px;
        }

        .table-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow-x: auto;
            overflow-y: visible;
            max-height: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: #ffffff;
        }

        thead {
            background: rgba(139, 0, 0, 0.5);
        }

        th {
            padding: 15px;
            text-align: left;
            font-family: 'Intro Rust', 'Arial Black', 'Arial', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-size: 1rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Arial', sans-serif;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .refresh-button {
            background: linear-gradient(135deg, #8b0000 0%, #660000 100%);
            border: 2px solid #ffffff;
            color: #ffffff;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            border-radius: 5px;
            margin: 20px auto;
            display: block;
            font-family: 'Intro Rust', 'Arial Black', 'Arial', sans-serif;
            transition: all 0.3s ease;
        }

        .refresh-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.8);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(139, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 20px 30px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffffff;
            font-family: 'Intro Rust', 'Arial Black', 'Arial', sans-serif;
        }

        .stat-label {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 10px;
        }

        .loading {
            text-align: center;
            color: #ffffff;
            font-size: 1.5rem;
            padding: 40px;
        }

        .error {
            text-align: center;
            color: #ff0000;
            font-size: 1.2rem;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1 class="dashboard-title glitch-text" data-text="ADMIN DASHBOARD">ADMIN DASHBOARD</h1>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalRegistrations">0</div>
                    <div class="stat-label">Total Registrations</div>
                </div>
            </div>
            <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                <button class="refresh-button" onclick="loadRegistrations()">REFRESH</button>
                <button class="refresh-button" onclick="exportRegistrationsToJSON()">EXPORT JSON</button>
                <button class="refresh-button" onclick="document.getElementById('importFile').click()">IMPORT JSON</button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importJSONFile(this)">
            </div>
        </div>

        <div class="table-container">
            <div id="loading" class="loading">Loading registrations...</div>
            <div id="error" class="error" style="display: none;"></div>
            <table id="registrationsTable" style="display: none;">
                <thead>
                     <tr>
                         <th>#</th>
                         <th>Full Name</th>
                         <th>Email</th>
                         <th>Phone Number</th>
                         <th>OS</th>
                         <th>Registration Date</th>
                     </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Check credentials on page load
        function checkCredentials() {
            const urlParams = new URLSearchParams(window.location.search);
            const name = urlParams.get('name') || '';
            const email = urlParams.get('email') || '';
            const phone = urlParams.get('phone') || '';

            const isAdmin = 
                name.toLowerCase() === 'pragna s' &&
                email.toLowerCase() === 'pragnabharadwaj09@gmail.com' &&
                phone === '8310438668';

            if (!isAdmin) {
                // Show login form if credentials don't match
                document.body.innerHTML = `
                    <div class="dashboard-container">
                        <div class="dashboard-header">
                            <h1 class="dashboard-title">ADMIN LOGIN</h1>
                            <form id="loginForm" style="max-width: 400px; margin: 0 auto; padding: 40px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 10px;">
                                <div class="form-group" style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; color: #ffffff; font-weight: bold;">Full Name</label>
                                    <input type="text" name="name" required style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); color: #ffffff; border-radius: 5px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; color: #ffffff; font-weight: bold;">Email</label>
                                    <input type="email" name="email" required style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); color: #ffffff; border-radius: 5px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; color: #ffffff; font-weight: bold;">Phone Number</label>
                                    <input type="tel" name="phone" required style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); color: #ffffff; border-radius: 5px;">
                                </div>
                                <button type="submit" class="refresh-button" style="width: 100%;">LOGIN</button>
                            </form>
                        </div>
                    </div>
                `;

                document.getElementById('loginForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(this);
                    const name = formData.get('name').trim();
                    const email = formData.get('email').trim();
                    const phone = formData.get('phone').trim();

                    if (name.toLowerCase() === 'pragna s' &&
                        email.toLowerCase() === 'pragnabharadwaj09@gmail.com' &&
                        phone === '8310438668') {
                        window.location.href = `dashboard.html?name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&phone=${encodeURIComponent(phone)}`;
                    } else {
                        alert('Invalid credentials. Access denied.');
                    }
                });
                return false;
            }
            return true;
        }

        function loadRegistrations() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const table = document.getElementById('registrationsTable');
            const tableBody = document.getElementById('tableBody');
            const totalRegistrations = document.getElementById('totalRegistrations');

            loading.style.display = 'block';
            error.style.display = 'none';
            table.style.display = 'none';

            try {
                // Load from localStorage
                const registrationsJson = localStorage.getItem('registrations');
                const registrations = registrationsJson ? JSON.parse(registrationsJson) : [];
                
                loading.style.display = 'none';
                totalRegistrations.textContent = registrations.length;
                
                if (registrations.length === 0) {
                    error.textContent = 'No registrations found.';
                    error.style.display = 'block';
                    return;
                }

                tableBody.innerHTML = '';
                registrations.forEach((reg, index) => {
                    const row = document.createElement('tr');
                    const date = reg.timestamp ? new Date(reg.timestamp).toLocaleString() : 'N/A';
                    const os = reg.os || 'N/A';
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${reg.name}</td>
                        <td>${reg.email}</td>
                        <td>${reg.phone}</td>
                        <td>${os.toUpperCase()}</td>
                        <td>${date}</td>
                    `;
                    tableBody.appendChild(row);
                });

                table.style.display = 'table';
            } catch (err) {
                loading.style.display = 'none';
                error.textContent = 'Error loading registrations: ' + err.message;
                error.style.display = 'block';
            }
        }

        async function importJSONFile(fileInput) {
            try {
                const registrations = await loadRegistrationsFromFile(fileInput);
                alert('JSON file imported successfully! ' + registrations.length + ' registration(s) loaded.');
                loadRegistrations();
            } catch (error) {
                alert('Error importing JSON file: ' + error);
            }
            // Reset file input
            fileInput.value = '';
        }

        function loadRegistrationsFromJSONFile() {
            // Try to load registrations.json file if it exists in the same directory
            fetch('registrations.json')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('File not found');
                })
                .then(registrations => {
                    // Save to localStorage
                    localStorage.setItem('registrations', JSON.stringify(registrations));
                    loadRegistrations();
                })
                .catch(error => {
                    // If file doesn't exist, load from localStorage instead
                    loadRegistrations();
                });
        }

        // Check credentials on page load
        if (checkCredentials()) {
            // Load registrations on page load (try from JSON file first, then localStorage)
            window.addEventListener('DOMContentLoaded', function() {
                loadRegistrationsFromJSONFile();
            });

            // Auto-refresh every 30 seconds
            setInterval(loadRegistrations, 30000);
        }
    </script>
</body>
</html>

